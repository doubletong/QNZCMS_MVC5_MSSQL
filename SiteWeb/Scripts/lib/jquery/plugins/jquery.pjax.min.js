/*!
 * Copyright 2012, Chris Wanstrath
 * Released under the MIT License
 * https://github.com/defunkt/jquery-pjax
 */
(function(n){function tt(t,i,r){var f=this;return this.on("click.pjax",t,function(t){var e=n.extend({},u(i,r));e.container||(e.container=n(this).attr("data-pjax")||f);v(t,e)})}function v(i,r,f){var e;if(f=u(r,f),e=i.currentTarget,e.tagName.toUpperCase()!=="A")throw"$.fn.pjax or $.pjax.click requires an anchor element";if(!(i.which>1)&&!i.metaKey&&!i.ctrlKey&&!i.shiftKey&&!i.altKey&&location.protocol===e.protocol&&location.hostname===e.hostname&&(!(e.href.indexOf("#")>-1)||b(e)!=b(location))&&!i.isDefaultPrevented()){var h={url:e.href,container:n(e).attr("data-pjax"),target:e},o=n.extend({},h,f),s=n.Event("pjax:click");n(e).trigger(s,[o]);s.isDefaultPrevented()||(t(o),i.preventDefault(),n(e).trigger("pjax:clicked",[o]))}}function it(i,r,f){var e,o;if(f=u(r,f),e=i.currentTarget,e.tagName.toUpperCase()!=="FORM")throw"$.pjax.submit requires a form element";if(o={type:e.method.toUpperCase(),url:e.action,container:n(e).attr("data-pjax"),target:e},o.type!=="GET"&&window.FormData!==undefined)o.data=new FormData(e),o.processData=!1,o.contentType=!1;else{if(n(e).find(":file").length)return;o.data=n(e).serializeArray()}t(n.extend({},o,f));i.preventDefault()}function t(i){function f(t,i,r){r||(r={});r.relatedTarget=c;var f=n.Event(t,r);return u.trigger(f,i),!f.isDefaultPrevented()}var o,e;i=n.extend(!0,{},n.ajaxSettings,t.defaults,i);n.isFunction(i.url)&&(i.url=i.url());var c=i.target,h=s(i.url).hash,u=i.context=k(i.container);return i.data||(i.data={}),n.isArray(i.data)?i.data.push({name:"_pjax",value:u.selector}):i.data._pjax=u.selector,i.beforeSend=function(n,t){if(t.type!=="GET"&&(t.timeout=0),n.setRequestHeader("X-PJAX","true"),n.setRequestHeader("X-PJAX-Container",u.selector),!f("pjax:beforeSend",[n,t]))return!1;t.timeout>0&&(o=setTimeout(function(){f("pjax:timeout",[n,i])&&n.abort("timeout")},t.timeout),t.timeout=0);i.requestUrl=s(t.url).href},i.complete=function(n,t){o&&clearTimeout(o);f("pjax:complete",[n,t,i]);f("pjax:end",[n,i])},i.error=function(n,t,u){var e=d("",n,i),o=f("pjax:error",[n,t,u,i]);i.type=="GET"&&t!=="abort"&&o&&r(e.url)},i.success=function(e,o,c){var k=t.state,w=typeof n.pjax.defaults.version=="function"?n.pjax.defaults.version():n.pjax.defaults.version,b=c.getResponseHeader("X-PJAX-Version"),l=d(e,c,i),v,a,y;if(w&&b&&w!==b){r(l.url);return}if(!l.contents){r(l.url);return}t.state={id:i.id||p(),url:l.url,title:l.title,container:u.selector,fragment:i.fragment,timeout:i.timeout};(i.push||i.replace)&&window.history.replaceState(t.state,l.title,l.url);try{document.activeElement.blur()}catch(g){}l.title&&(document.title=l.title);f("pjax:beforeReplace",[l.contents,i],{state:t.state,previousState:k});u.html(l.contents);v=u.find("input[autofocus], textarea[autofocus]").last()[0];v&&document.activeElement!==v&&v.focus();et(l.scripts);typeof i.scrollTo=="number"&&n(window).scrollTop(i.scrollTo);h!==""&&(a=s(l.url),a.hash=h,t.state.url=a.href,window.history.replaceState(t.state,l.title,a.href),y=document.getElementById(a.hash.slice(1)),y&&n(window).scrollTop(n(y).offset().top));f("pjax:success",[e,o,c,i])},t.state||(t.state={id:p(),url:window.location.href,title:document.title,container:u.selector,fragment:i.fragment,timeout:i.timeout},window.history.replaceState(t.state,document.title)),e=t.xhr,e&&e.readyState<4&&(e.onreadystatechange=n.noop,e.abort()),t.options=i,e=t.xhr=n.ajax(i),e.readyState>0&&(i.push&&!i.replace&&(ot(t.state.id,u.clone().contents()),window.history.pushState(null,"",w(i.requestUrl))),f("pjax:start",[e,i]),f("pjax:send",[e,i])),t.xhr}function rt(i,r){var f={url:window.location.href,push:!1,replace:!0,scrollTo:!1};return t(n.extend(f,u(i,r)))}function r(n){window.history.replaceState(null,"",t.state.url);window.location.replace(n)}function y(u){var v=t.state,f=u.state,o,c,h,l,s,a;if(f&&f.container){if(e&&ut==f.url)return;if(t.state&&t.state.id===f.id)return;o=n(f.container);o.length?(h=i[f.id],t.state&&(c=t.state.id<f.id?"forward":"back",st(c,t.state.id,o.clone().contents())),l=n.Event("pjax:popstate",{state:f,direction:c}),o.trigger(l),s={id:f.id,url:f.url,container:o,push:!1,fragment:f.fragment,timeout:f.timeout,scrollTo:!1},h?(o.trigger("pjax:start",[null,s]),t.state=f,f.title&&(document.title=f.title),a=n.Event("pjax:beforeReplace",{state:f,previousState:v}),o.trigger(a,[h,s]),o.html(h),o.trigger("pjax:end",[null,s])):t(s),o[0].offsetHeight):r(location.href)}e=!1}function ft(t){var f=n.isFunction(t.url)?t.url():t.url,u=t.type?t.type.toUpperCase():"GET",r=n("<form>",{method:u==="GET"?"GET":"POST",action:f,style:"display:none"}),i;if(u!=="GET"&&u!=="POST"&&r.append(n("<input>",{type:"hidden",name:"_method",value:u.toLowerCase()})),i=t.data,typeof i=="string")n.each(i.split("&"),function(t,i){var u=i.split("=");r.append(n("<input>",{type:"hidden",name:u[0],value:u[1]}))});else if(typeof i=="object")for(key in i)r.append(n("<input>",{type:"hidden",name:key,value:i[key]}));n(document.body).append(r);r.submit()}function p(){return(new Date).getTime()}function w(n){return n.replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"")}function s(n){var t=document.createElement("a");return t.href=n,t}function b(n){return n.href.replace(/#.*/,"")}function u(t,i){return t&&i?i.container=t:i=n.isPlainObject(t)?t:{container:t},i.container&&(i.container=k(i.container)),i}function k(t){if(t=n(t),t.length){if(t.selector!==""&&t.context===document)return t;if(t.attr("id"))return n("#"+t.attr("id"));throw"cant get selector for pjax container!";}else throw"no pjax container for "+t.selector;}function h(n,t){return n.filter(t).add(n.find(t))}function c(t){return n.parseHTML(t,document,!0)}function d(t,i,r){var u={},s=/<html/i.test(t),f,o,e;return(u.url=w(i.getResponseHeader("X-PJAX-URL")||r.requestUrl),s?(o=n(c(t.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0])),f=n(c(t.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]))):o=f=n(c(t)),f.length===0)?u:(u.title=h(o,"title").last().text(),r.fragment?(e=r.fragment==="body"?f:h(f,r.fragment).first(),e.length&&(u.contents=r.fragment==="body"?e:e.contents(),u.title||(u.title=e.attr("title")||e.data("title")))):s||(u.contents=f),u.contents&&(u.contents=u.contents.not(function(){return n(this).is("title")}),u.contents.find("title").remove(),u.scripts=h(u.contents,"script[src]").remove(),u.contents=u.contents.not(u.scripts)),u.title&&(u.title=n.trim(u.title)),u)}function et(t){if(t){var i=n("script[src]");t.each(function(){var u=this.src,f=i.filter(function(){return this.src===u}),t,r;f.length||(t=document.createElement("script"),r=n(this).attr("type"),r&&(t.type=r),t.src=n(this).attr("src"),document.head.appendChild(t))})}}function ot(n,r){i[n]=r;f.push(n);a(l,0);a(f,t.defaults.maxCacheLength)}function st(n,r,u){var e,o;i[r]=u;n==="forward"?(e=f,o=l):(e=l,o=f);e.push(r);(r=o.pop())&&delete i[r];a(e,t.defaults.maxCacheLength)}function a(n,t){while(n.length>t)delete i[n.shift()]}function ht(){return n("meta").filter(function(){var t=n(this).attr("http-equiv");return t&&t.toUpperCase()==="X-PJAX-VERSION"}).attr("content")}function g(){n.fn.pjax=tt;n.pjax=t;n.pjax.enable=n.noop;n.pjax.disable=nt;n.pjax.click=v;n.pjax.submit=it;n.pjax.reload=rt;n.pjax.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:ht};n(window).on("popstate.pjax",y)}function nt(){n.fn.pjax=function(){return this};n.pjax=ft;n.pjax.enable=g;n.pjax.disable=n.noop;n.pjax.click=n.noop;n.pjax.submit=n.noop;n.pjax.reload=function(){window.location.reload()};n(window).off("popstate.pjax",y)}var e=!0,ut=window.location.href,o=window.history.state;o&&o.container&&(t.state=o);"state"in window.history&&(e=!1);var i={},l=[],f=[];n.inArray("state",n.event.props)<0&&n.event.props.push("state");n.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/);n.support.pjax?g():nt()})(jQuery);